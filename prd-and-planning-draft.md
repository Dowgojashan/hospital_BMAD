# PRD & 專案管理初稿 — 線上醫院掛號與診務系統

版本：0.1
作者：Product Manager
參考文件：`project-brief.md`

---

## 一、專案管理初稿（Project Planning Draft）

### 1. 專案範疇（Scope / MVP Boundary）
- 納入：六大核心模組
  1. 使用者與身分管理（User Management）
  2. 門診與班表管理（Clinic & Schedule Management）
  3. 線上掛號與預約（Registration & Scheduling）
  4. 到診報到與候診排隊（Check-in & Queue Management）
  5. 病歷資料管理（Electronic Health Record Management）
  6. 診務通訊與管理儀表板（Communication & Admin Dashboard）

- 明確排除（MVP）：
  - 排除急診特殊流程與急診資源調度（不處理急診分流、急救優先權）。
  - 排除遠距醫療／視訊診療功能（符合法規限制）。
  - 排除第三方線上付費或保險理賠整合（可作為後續擴充）。

### 2. 初步時程估算（Initial Timeline — 12 週建議）
說明：以週為單位的高階開發節奏，假設團隊以敏捷雙週迭代（2 週 Sprint）執行。

- Week 0: 啟動與需求細化（Stakeholder workshop、法務/資安檢視、架構預研）
- Week 1–3 (3w): Epic A — 使用者與身分管理（設計、基礎身分驗證、RBAC）
- Week 4–5 (2w): Epic B — 門診與班表管理（查詢介面、班表 CRUD、停診流程）
- Week 6–7 (2w): Epic C — 線上掛號與預約（時段查詢、預約建立、提醒）
- Week 8–9 (2w): Epic D — 到診報到與候診排隊（報到、Kiosk 流程、過號處理）
- Week 10 (1w): Epic E — 病歷資料管理（只讀查詢 + 醫師審核的編輯流程）
- Week 11 (1w): Epic F — 診務通訊與管理儀表板（通知管線、儀表板基本 KPI）
- Week 12: 巡檢、修正、試點準備與上線前合規檢核

備註：時程可依醫院可用資源、API/整合複雜度進行調整；若病歷整合複雜度高，可能需將 Epic E 延伸為 2–3 週。

### 3. 資源要求（Core Team｜初步）
- 1 Product Manager (兼任專案負責監控進度與利害關係人溝通)
- 1 UX / UI 設計師（可分階段輸出 wireframes 與 Kiosk UI）
- 2 Backend 開發（含 API 與整合、資料庫設計）
- 1 Frontend 開發（Web/Mobile responsive；Kiosk 前端可簡化）
- 1 QA / 測試工程師（含自動化測試與安全/合規測試）
- 1 DevOps / SRE（部署腳本、CI/CD、監控；可為兼職）
- 1 臨床業務聯絡人（Hospital Liaison，協助流程驗證、User Acceptance）

建議：若能支援，加入 0.5 FTE 的資安/合規工程師，與 0.5 FTE 的資料工程師以協助 EHR 整合與報表需求。

### 4. 風險與外部依賴（Top Risks & Dependencies）

主要技術風險（Top 3）：
1. 與醫院既有 HIS/EHR 的資料整合難度（API 不一致或無 API，需人工作業）。
2. 病歷資料同步與資料一致性問題（寫入/編輯權限與審計需求導致流程複雜）。
3. 通知送達可靠性（依賴外部 SMS/Email/Push 供應商，影響使用者體驗）。

主要外部依賴（Top 2）：
1. 法務/合規審查與醫院資訊安全規範批准（影響上線時程）。
2. 醫院提供資料介面（API 或批次匯出）與內部測試環境／匿名測試資料。

---

## 二、產品需求文件（PRD）

### 目標概述
本系統旨在提供院內掛號、報到、候診與病歷查詢的一站式服務，以提升行政效率、改善病患體驗並降低人工錯誤；首版目標為可在 12 週內部署到試點科別（非急診）。

### Epics（依六大模組拆解）
以下每個 Epic 包含簡短描述、至少 3 個 User Stories（含接受準則）。

---

#### Epic A — 使用者與身分管理（User Management）
描述：建立統一的身份驗證與授權服務，支援病患、醫師、管理員角色與權限管理。

User Story A1
- 描述：作為一名病患，我希望能在線上註冊帳號並填寫聯絡資訊，以便完成預約與接收通知。
- 驗收標準：
  - 病患可以使用電子郵件或手機號碼註冊帳號並完成電子郵件/手機驗證。
  - 註冊流程包含必填欄位：姓名、生日、聯絡電話、電子郵件、健保卡號（使用虛擬健保卡號來模擬就好）。
  - 註冊完成後自動建立病患檔案並能即時用於預約流程（新建立的帳號在 5 分鐘內能呼叫預約 API）。

User Story A2
- 描述：作為一名醫師，我希望能使用醫院提供的帳號登入系統，以便查看個人班表與病患報到狀態。
- 驗收標準：
  - 醫師可透過 SSO（若醫院提供）或系統帳號登入，登入成功率 >= 99%（非網路中斷情況）。
  - 登入後 3 秒內顯示今日班表與當下候診名單（在測試資料環境）。

User Story A3
- 描述：作為管理員，我希望能建立與管理不同角色帳號，以控管系統存取權限。
- 驗收標準：
  - 管理員可新增/停用/修改帳號角色（病患/醫師/管理員）。
  - 該操作需被記錄到審計日誌，包含操作者 ID、時間戳與變更摘要。

User Story A4 (安全)
- 描述：作為系統管理者，我希望系統支援密碼重設與多因素驗證（可選），以提高帳號安全。
- 驗收標準：
  - 使用者可發起密碼重設流程並透過驗證碼完成重設。
  - 系統可啟用 OTP 類型的多因素驗證；啟用後登入需額外通過 MFA。

---

#### Epic B — 門診與班表管理（Clinic & Schedule Management）
描述：提供班表 CRUD、班表查詢，以及醫師停診申請與管理員核准流程。

User Story B1
- 描述：作為病患，我要能查詢某科別或特定醫師的班表，以方便選擇時段預約。
- 驗收標準：
  - 病患可依科別、醫師名稱或日期篩選班表。
  - 查詢結果在 2 秒內返回（在正常負載下）。

User Story B2
- 描述：作為醫師，我要能提交『停診申請』並附上停診原因，以便管理員處理並自動通知受影響病患。
- 驗收標準：
  - 醫師可為未來日期提出停診申請，需包含停診時段、原因與備註。
  - 管理員在介面能看到待審核的停診申請並能核准或拒絕，核准後系統自動更新班表並發送通知給受影響的預約者。

User Story B3
- 描述：作為管理員，我希望能快速新增或調整臨時班次以應對流量變化。
- 驗收標準：
  - 管理員在 5 分鐘內能新增臨時班次並同步至病患查詢介面。
  - 新增/修改班次的操作會被記錄於審計日誌。

---

#### Epic C — 線上掛號與預約（Registration & Scheduling）
描述：病患線上查看時段、掛號、候補與提醒流程；不含先付款。

User Story C1
- 描述：作為病患，我希望能在行動裝置上選擇科別、醫師和時段完成掛號。
- 驗收標準：
  - 病患可選擇科別/醫師/時段並提交預約申請，系統回傳預約編號。
  - 若時段已滿，病患可加入候補清單並收到候補成功通知。

User Story C2
- 描述：作為病患，我希望在預約前收到可視化的時段可用性（即時），以做出選擇。
- 驗收標準：
  - 顯示的時段可用性為系統實際狀態（在 5 秒內更新）。
  - 系統在建立預約時對時段做最終鎖定，避免雙重預約。

User Story C3
- 描述：作為管理員，我希望設定自動提醒規則（例如提前 48h、24h、2h），以降低爽約率。
- 驗收標準：
  - 可配置的提醒模板可選擇透過 SMS/Email/推播發送，模板支援簡短與詳細兩種格式。
  - 系統紀錄每次提醒發送結果（送達/失敗）。

---

#### Epic D — 到診報到與候診排隊（Check-in & Queue Management）
描述：支援線上報到、Kiosk 報到、實時排隊與過號處理（簡化急診情境）。

User Story D1
- 描述：作為病患，我希望能在線上或 Kiosk 完成報到，避免現場排長龍。
- 驗收標準：
  - 病患可於預約時段前線上報到，系統在報到後更新候診名單並通知對應診間。
  - 報到流程在 30 秒以內完成（含網路延遲）。

User Story D2
- 描述：作為病患，我希望在號碼即將到達時收到提醒，以便提早準備進診間。
- 驗收標準：
  - 系統於號碼前兩名時發送單向提醒給病患（SMS/推播），並記錄發送結果。

User Story D3
- 描述：作為管理員，我希望系統能自動處理過號情況（例如重新候補或自動取消並通知病患），以維持候診秩序。
- 驗收標準：
  - 系統能依預設規則判定過號並執行指定動作（重新候補），並發送通知。
  - 任何過號導致的狀態變更都有審計紀錄。

---

#### Epic E — 病歷資料管理（Electronic Health Record Management）
描述：提供病歷的查詢與（受控的）醫師編輯能力，強調資料完整性、審計日誌與嚴格的存取權限控制。

User Story E1
- 描述：作為病患，我希望能查看並下載我的就診摘要與檢驗報告，以便自主管理健康紀錄。
- 驗收標準：
  - 病患可在個人介面查看最近 N 次就診摘要與檢驗報告（N 由醫院設定，預設 12 個月）。
  - 病患可下載 PDF 格式的就診摘要，但無法修改病歷內容。

User Story E2
- 描述：作為醫師，我希望能新增診療筆記與上傳檢驗報告，以記錄臨床決策並供後續查詢。
- 驗收標準：
  - 醫師可新增或修改診療筆記，所有變更需包含操作者 ID 與時間戳，並被寫入不可變更的審計日誌中。
  - 上傳檔案需通過病毒掃描與格式檢查，成功上傳後能在病患查詢介面顯示連結（依存取權限）。

User Story E3
- 描述：作為系統管理員，我希望有可搜尋的審計日誌，能回溯誰在何時對哪筆病歷做了什麼操作，以配合法務或稽核需求。
- 驗收標準：
  - 審計日誌包含：操作者 ID、操作類型（新增/修改/刪除/檢視）、目標病歷 ID、時間戳、來源 IP/裝置識別（若可得）。
  - 日誌不可被系統使用者刪除，並支援匯出（CSV/JSON）以便法務或稽核使用。

User Story E4 (存取控管)
- 描述：作為資安負責人，我希望系統能支援基於角色的存取控管（RBAC）並細分敏感欄位的讀寫權限，以符合法規。
- 驗收標準：
  - 系統支援角色與權限矩陣：醫師可讀寫其負責病患之完整病歷；行政僅能讀取非敏感欄位（如聯絡資訊）；病患僅能讀取摘要。
  - 任一嘗試未授權存取的行為會被阻擋並寫入審計日誌，且管理員可在 1 小時內收到異常警示（若設定）。

---

#### Epic F — 診務通訊與管理儀表板（Communication & Admin Dashboard）
描述：實作院內單向通知機制與運營儀表板，用以支援醫護與管理決策。

User Story F1
- 描述：作為管理員，我希望在儀表板上看到即時門診流量與各診間負載，以便快速調配人力。
- 驗收標準：
  - 儀表板在 5 秒內更新當前候診人數與診間負載（在正常資料流下）。

User Story F2
- 描述：作為醫護人員，我希望在病患到診或取消時收到系統通知，以便調整門診安排。
- 驗收標準：
  - 病患報到或取消事件會在 30 秒內觸發內部通知至相關醫護端，並記錄送達結果。

User Story F3
- 描述：作為病患，我希望在我的看診號碼接近時收到單向提醒，以便準備就診。
- 驗收標準：
  - 在號碼前兩名時發送單向提醒到病患，並記錄送達狀態；若送達失敗，系統保留重新嘗試策略或告知管理員手動處理。

---

### 非功能性需求（NFRs）

1. 效能（Performance）
  - 目標：系統在平常時段所有核心查詢（班表查詢、預約查詢、候診人數）應於 95th 百分位小於 1.5 秒回應（在測試資料與預期負載下）。
  - 高峰期（例如早上 08:00–09:30）仍需保證列表/查詢型 API 95th 百分位 < 2.5 秒；預約建立 API 的 95th 百分位 < 3 秒（含鎖定邏輯）。

2. 安全與合規（Security & Compliance）
  - 傳輸層：所有 API 與前端通訊使用 TLS 1.2+（建議 TLS 1.3）。
  - 靜態資料保護：所有敏感資料（病歷內容、身份識別資訊）在儲存時至少使用 AES-256 加密。
  - 存取控管：實作 RBAC，支援最小權限原則，並支援 SSO（若醫院提供）與 MFA 作為選項。
  - 審計日誌：所有病歷讀/寫/刪操作需寫入不可變更的審計日誌（包括操作者、時間戳、來源），日誌需保存至少 7 年或依醫院合規要求。
  - 資安測試：上線前需完成靜態程式碼掃描、動態弱點掃描（DAST）與一次穿透測試（可由第三方執行）。

3. 可用性（Availability / SLA）
  - 目標：系統可用性 SLA 初步設定為 99.9%（每年可接受停機時間約 8.77 小時）。
  - 關鍵元件（身份驗證、預約建立、通知管線）需具備基本重試機制與降級模式（例如通知失敗時記錄並重試）。

4. 可維運性（Maintainability）
  - 系統需提供監控與告警（CPU、記憶體、API 延遲、錯誤率、通知失敗率），並能匯出使用與錯誤日誌以協助排查。

5. 可擴展性（Scalability）
  - 設計 API 與資料層以支援橫向擴充（stateless API、Redis/隊列協助排隊計數）。

---

## 系統架構師（Architect）下一步指示
請架構師在下一階段執行以下工作：

1. 定義系統整合契約（API 合約）與資料模型
  - 明確列出需與 HIS/EHR 整合的資料欄位（班表、預約狀態、病歷摘要、病患基本資料）與同步頻率。
  - 提供 REST/GraphQL API 規格草案（含認證方式、回傳樣板、錯誤碼標準）。

2. 設計身份驗證與授權架構
  - 建議 SSO 支援策略（若醫院提供）；否則提供 OAuth2 + RBAC 實作建議。
  - 設計審計日誌儲存方案（寫入不可變更日誌、連結到中央稽核服務或 WORM 儲存）。

3. 通知管線設計
  - 定義通知服務（內部通知、SMS/Email/Push 介面）與重試策略、監控指標。

4. 資料隱私與備援策略
  - 提供資料加密、金鑰管理建議（KMS）、備援/備份政策與保留策略。

5. 提供一份最低可行的部署拓撲（包含開發/測試/生產環境）與 CI/CD 建議。

---

## 交付與下一步建議
1. 於 1 週內召開啟動會議（含臨床代表、IT、資安/法務、管理端）釐清 API 與合規需求。 
2. 於第 2 週完成技術整合可行性報告（HIS/EHR 介面現況）。
3. 依時程開啟第一個 Sprint，優先將 A/B/C Epics 進入開發與測試。

---

文件結束。
