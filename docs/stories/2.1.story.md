# <!-- Powered by BMADâ„¢ Core -->
sections:
  - id: status
    title: Status
    type: choice
    choices: [Draft, Approved, InProgress, Review, Done]
    instruction: Select the current status of the story
    owner: scrum-master
    editors: [scrum-master, dev-agent]
    value: Draft

  - id: story
    title: Story
    type: template-text
    template: |
      **As a** Administrator,
      **I want** to be able to create, view, update, and delete doctor schedules,
      **so that** I can manage the clinic's operational hours and doctor availability.
    instruction: Define the user story using the standard format with role, action, and benefit
    elicit: true
    owner: scrum-master
    editors: [scrum-master]

  - id: acceptance-criteria
    title: Acceptance Criteria
    type: numbered-list
    instruction: Copy the acceptance criteria numbered list from the epic file
    elicit: true
    owner: scrum-master
    editors: [scrum-master]
    value: |
      1. An administrator can create a new schedule for a doctor, specifying the date, start time, and end time.
      2. An administrator can view a list of all schedules, with options to filter by doctor and/or date range.
      3. An administrator can update an existing schedule's date, start time, or end time.
      4. An administrator can delete a schedule.
      5. All schedule management operations (create, update, delete) must be protected and only accessible by users with the 'admin' role.
      6. The system shall provide API endpoints for all CRUD operations on schedules.

  - id: tasks-subtasks
    title: Tasks / Subtasks
    type: bullet-list
    instruction: |
      Break down the story into specific tasks and subtasks needed for implementation.
      Reference applicable acceptance criteria numbers where relevant.
    template: |
      - [x] Task 1 (AC: 1, 6): Create Pydantic schemas for schedules.
        - [x] Subtask 1.1: Create `backend/app/schemas/schedule.py`.
        - [x] Subtask 1.2: Define `ScheduleBase`, `ScheduleCreate`, `ScheduleUpdate`, and `Schedule` (for public view) schemas.
      - [x] Task 2 (AC: 1, 2, 3, 4, 6): Implement CRUD functions for schedules.
        - [x] Subtask 2.1: Create `backend/app/crud/crud_schedule.py`.
        - [x] Subtask 2.2: Implement `create_schedule`.
        - [x] Subtask 2.3: Implement `get_schedule`.
        - [x] Subtask 2.4: Implement `list_schedules` with filtering.
        - [x] Subtask 2.5: Implement `update_schedule`.
        - [x] Subtask 2.6: Implement `delete_schedule`.
      - [x] Task 3 (AC: 1, 2, 3, 4, 5, 6): Create API endpoints for schedule management.
        - [x] Subtask 3.1: Create `backend/app/api/routers/schedules.py`.
        - [x] Subtask 3.2: Implement `POST /schedules/` endpoint.
        - [x] Subtask 3.3: Implement `GET /schedules/` endpoint.
        - [x] Subtask 3.4: Implement `PUT /schedules/{schedule_id}` endpoint.
        - [x] Subtask 3.5: Implement `DELETE /schedules/{schedule_id}` endpoint.
        - [x] Subtask 3.6: Secure all endpoints to be accessible only by administrators.
      - [x] Task 4 (AC: 6): Register the new router in the main application.
        - [x] Subtask 4.1: Modify `backend/app/main.py` to include the `schedules` router.
      - [ ] Task 5 (AC: 1-6): Write tests for the new functionality.
        - [ ] Subtask 5.1: Write unit tests for `crud_schedule.py`.
        - [ ] Subtask 5.2: Write API tests for the `schedules` router, covering all endpoints and authentication/authorization.
    elicit: true
    owner: scrum-master
    editors: [scrum-master, dev-agent]

  - id: dev-notes
    title: Dev Notes
    instruction: |
      Populate relevant information, only what was pulled from actual artifacts from docs folder, relevant to this story:
      - Do not invent information
      - If known add Relevant Source Tree info that relates to this story
      - If there were important notes from previous story that are relevant to this one, include them here
      - Put enough information in this section so that the dev agent should NEVER need to read the architecture documents, these notes along with the tasks and subtasks must give the Dev Agent the complete context it needs to comprehend with the least amount of overhead the information to complete the story, meeting all AC and completing all tasks+subtasks
    elicit: true
    owner: scrum-master
    editors: [scrum-master]
    value: |
      **Data Models:**
      - Use the existing `Schedule` model in `models/schedule.py`.
      - Use the existing `Doctor` model in `models/doctor.py`.
      - [Source: `prd_1.md`, section `SCHEDULE`]

      **API Specifications:**
      - Create a new router at `backend/app/api/routers/schedules.py`.
      - Endpoints:
          - `POST /schedules/`: Create a new schedule.
          - `GET /schedules/`: List schedules, with optional `doctor_id` and `date` query parameters.
          - `PUT /schedules/{schedule_id}`: Update a schedule.
          - `DELETE /schedules/{schedule_id}`: Delete a schedule.
      - All endpoints must require authentication and authorization for the 'admin' role.
      - [Source: `system_architecture_plan.md`, section `REST-API-Spec` (inferred)]

      **File Locations:**
      - Schemas: `backend/app/schemas/schedule.py`
      - CRUD logic: `backend/app/crud/crud_schedule.py`
      - API Router: `backend/app/api/routers/schedules.py`
      - Main app: `backend/app/main.py` (to include the new router)
      - [Source: `system_architecture_plan.md`, section `Frontend Tech Stack` (backend structure)]

      **Testing Requirements:**
      - Unit tests for `crud_schedule.py` functions.
      - API tests for all endpoints in `schedules.py`, including tests for authentication and authorization.
      - [Source: `system_architecture_plan.md`, section `Testing Strategy`]

  - id: change-log
    title: Change Log
    type: table
    columns: [Date, Version, Description, Author]
    instruction: Track changes made to this story document
    owner: scrum-master
    editors: [scrum-master, dev-agent, qa-agent]

  - id: dev-agent-record
    title: Dev Agent Record
    instruction: This section is populated by the development agent during implementation
    owner: dev-agent
    editors: [dev-agent]
    sections:
      - id: agent-model
        title: Agent Model Used
        template: "{{agent_model_name_version}}"
        instruction: Record the specific AI agent model and version used for development
        owner: dev-agent
        editors: [dev-agent]

      - id: debug-log-references
        title: Debug Log References
        instruction: Reference any debug logs or traces generated during development
        owner: dev-agent
        editors: [dev-agent]

      - id: completion-notes
        title: Completion Notes List
        instruction: Notes about the completion of tasks and any issues encountered
        owner: dev-agent
        editors: [dev-agent]

      - id: file-list
        title: File List
        instruction: List all files created, modified, or affected during story implementation
        owner: dev-agent
        editors: [dev-agent]
        value: |
          **Created:**
          - `backend/app/schemas/schedule.py`
          - `backend/app/crud/crud_schedule.py`
          - `backend/app/api/routers/schedules.py`
          **Modified:**
          - `backend/app/main.py`

  - id: qa-results
    title: QA Results
    instruction: Results from QA Agent QA review of the completed story implementation
    owner: qa-agent
    editors: [qa-agent]
